{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://architects-toolkit.github.io/ghjson-spec/schema/v1.0/ghjson.schema.json",
  "title": "GhJSON Document",
  "description": "GhJSON is a JSON-based format for representing Grasshopper definitions. It provides a human-readable, portable way to serialize and deserialize Grasshopper documents.",
  "type": "object",
  "required": ["components"],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "description": "The GhJSON schema version. Used for compatibility checking.",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "default": "1.0",
      "examples": ["1.0", "1.0.0"]
    },
    "metadata": {
      "$ref": "#/$defs/documentMetadata",
      "description": "Optional document metadata including author, description, and version information."
    },
    "components": {
      "type": "array",
      "description": "List of all components in the document. This is the primary content of a GhJSON file.",
      "items": {
        "$ref": "#/$defs/component"
      }
    },
    "connections": {
      "type": "array",
      "description": "List of all connections (wires) between component parameters.",
      "items": {
        "$ref": "#/$defs/connectionPairing"
      }
    },
    "groups": {
      "type": "array",
      "description": "List of component groups for organization.",
      "items": {
        "$ref": "#/$defs/group"
      }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "documentMetadata": {
      "type": "object",
      "description": "Metadata about the Grasshopper document.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the definition."
        },
        "description": {
          "type": "string",
          "description": "A description of what this definition does."
        },
        "version": {
          "type": "string",
          "description": "Version of the definition itself (not the schema)."
        },
        "author": {
          "type": "string",
          "description": "The author of this definition."
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp in ISO 8601 format."
        },
        "modified": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification timestamp in ISO 8601 format."
        },
        "rhinoVersion": {
          "type": "string",
          "description": "The Rhino version this definition was created with.",
          "examples": ["8.24", "7.12"]
        },
        "grasshopperVersion": {
          "type": "string",
          "description": "The Grasshopper version this definition was created with."
        },
        "tags": {
          "type": "array",
          "description": "List of tags for categorizing and searching definitions.",
          "items": {
            "type": "string"
          }
        },
        "dependencies": {
          "type": "array",
          "description": "List of required plugin dependencies.",
          "items": {
            "type": "string"
          }
        },
        "componentCount": {
          "type": "integer",
          "description": "Total number of components in the document.",
          "minimum": 0
        },
        "connectionCount": {
          "type": "integer",
          "description": "Total number of connections in the document.",
          "minimum": 0
        },
        "groupCount": {
          "type": "integer",
          "description": "Total number of groups in the document.",
          "minimum": 0
        },
        "plugin": {
          "type": "string",
          "description": "Name of the plugin that generated this GhJSON file."
        },
        "pluginVersion": {
          "type": "string",
          "description": "Version of the plugin that generated this file."
        }
      },
      "additionalProperties": true
    },
    "component": {
      "type": "object",
      "description": "Represents a single Grasshopper component or parameter.",
      "required": ["name", "id"],
      "properties": {
        "name": {
          "type": "string",
          "description": "The display name of the component.",
          "examples": ["Addition", "Panel", "Number Slider", "C# Script"]
        },
        "library": {
          "type": "string",
          "description": "The component library/category (e.g., 'Maths', 'Params')."
        },
        "type": {
          "type": "string",
          "description": "The component type/subcategory."
        },
        "nickName": {
          "type": "string",
          "description": "Custom nickname for the component."
        },
        "componentGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for the component type. Used to instantiate the correct component class."
        },
        "instanceGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for this specific component instance."
        },
        "id": {
          "type": "integer",
          "description": "Integer ID for compact reference in connections and groups. Must be unique within the document.",
          "minimum": 1
        },
        "selected": {
          "type": "boolean",
          "description": "Whether the component is currently selected on the canvas."
        },
        "pivot": {
          "$ref": "#/$defs/pivot",
          "description": "The position of the component on the canvas."
        },
        "params": {
          "type": "object",
          "description": "Simple key-value pairs for basic component properties.",
          "additionalProperties": true
        },
        "inputSettings": {
          "type": "array",
          "description": "Configuration for input parameters.",
          "items": {
            "$ref": "#/$defs/parameterSettings"
          }
        },
        "outputSettings": {
          "type": "array",
          "description": "Configuration for output parameters.",
          "items": {
            "$ref": "#/$defs/parameterSettings"
          }
        },
        "componentState": {
          "$ref": "#/$defs/componentState",
          "description": "UI-specific state for the component."
        },
        "warnings": {
          "type": "array",
          "description": "List of warning messages associated with the component.",
          "items": {
            "type": "string"
          }
        },
        "errors": {
          "type": "array",
          "description": "List of error messages associated with the component.",
          "items": {
            "type": "string"
          }
        },
        "properties": {
          "type": "object",
          "description": "Legacy schema-specific properties (for backward compatibility).",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "pivot": {
      "description": "The position of a component on the Grasshopper canvas. Can be either a compact string format or an object.",
      "oneOf": [
        {
          "type": "string",
          "description": "Compact format: 'X,Y' where X and Y are floating-point numbers.",
          "pattern": "^-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?$",
          "examples": ["100,200", "-50.5,300.25"]
        },
        {
          "type": "object",
          "description": "Object format with explicit X and Y properties.",
          "properties": {
            "X": {
              "type": "number",
              "description": "X coordinate on the canvas."
            },
            "Y": {
              "type": "number",
              "description": "Y coordinate on the canvas."
            }
          },
          "required": ["X", "Y"],
          "additionalProperties": false
        }
      ]
    },
    "parameterSettings": {
      "type": "object",
      "description": "Configuration for a component's input or output parameter.",
      "required": ["parameterName"],
      "properties": {
        "parameterName": {
          "type": "string",
          "description": "The name of the parameter."
        },
        "nickName": {
          "type": "string",
          "description": "Custom nickname for the parameter."
        },
        "description": {
          "type": "string",
          "description": "Description of the parameter."
        },
        "isPrincipal": {
          "type": "boolean",
          "description": "Whether this is the principal (master) input parameter. Affects parameter matching behavior."
        },
        "required": {
          "type": "boolean",
          "description": "Whether this parameter is required (cannot be removed). Applicable to variable parameter components."
        },
        "dataMapping": {
          "type": "string",
          "description": "Data tree mapping mode.",
          "enum": ["None", "Flatten", "Graft", "Simplify"]
        },
        "isReparameterized": {
          "type": "boolean",
          "description": "Whether the parameter domain is reparameterized."
        },
        "expression": {
          "type": "string",
          "description": "Expression that transforms parameter data. The presence of this property implies the parameter has an expression."
        },
        "variableName": {
          "type": "string",
          "description": "Variable name for script parameters."
        },
        "access": {
          "type": "string",
          "description": "Data access mode for script parameters.",
          "enum": ["item", "list", "tree"]
        },
        "typeHint": {
          "type": "string",
          "description": "Type hint for script parameters (e.g., 'int', 'double', 'Point3d')."
        },
        "additionalSettings": {
          "$ref": "#/$defs/additionalParameterSettings",
          "description": "Additional parameter flags and modifiers."
        }
      },
      "additionalProperties": false
    },
    "additionalParameterSettings": {
      "type": "object",
      "description": "Additional flags and modifiers for parameters.",
      "properties": {
        "reverse": {
          "type": "boolean",
          "description": "Whether to reverse the parameter data order."
        },
        "simplify": {
          "type": "boolean",
          "description": "Whether to simplify the parameter data tree."
        },
        "isPrincipal": {
          "type": "boolean",
          "description": "Whether this parameter is principal for matching."
        },
        "locked": {
          "type": "boolean",
          "description": "Whether the parameter is locked."
        },
        "invert": {
          "type": "boolean",
          "description": "Whether to invert boolean values (Param_Boolean only)."
        },
        "unitize": {
          "type": "boolean",
          "description": "Whether to unitize vectors (Param_Vector only)."
        }
      },
      "additionalProperties": false
    },
    "componentState": {
      "type": "object",
      "description": "UI-specific state for components. The properties used depend on the component type.",
      "properties": {
        "value": {
          "description": "The primary value for the component. Format depends on component type:\n- Number Slider: '5<2,10>' (value with range)\n- Panel/Scribble: 'text content'\n- Value List: [{\"Name\":\"A\",\"Expression\":\"0\"}]\n- Script (C#/Python): 'code string'\n- Multidimensional Slider: '1.0,2.0,3.0'"
        },
        "vbCode": {
          "$ref": "#/$defs/vbScriptCode",
          "description": "VB Script code with separate sections. Takes precedence over 'value' for VB Script components."
        },
        "locked": {
          "type": "boolean",
          "description": "Whether the component is locked (disabled)."
        },
        "hidden": {
          "type": "boolean",
          "description": "Whether the component preview is hidden."
        },
        "enabled": {
          "type": "boolean",
          "description": "Whether the component is enabled."
        },
        "preview": {
          "type": "boolean",
          "description": "Whether preview is enabled."
        },
        "multiline": {
          "type": "boolean",
          "description": "Whether multiline mode is enabled (panels, text components)."
        },
        "wrap": {
          "type": "boolean",
          "description": "Whether text wrapping is enabled."
        },
        "color": {
          "type": "object",
          "description": "Component color as RGBA values.",
          "properties": {
            "r": { "type": "integer", "minimum": 0, "maximum": 255 },
            "g": { "type": "integer", "minimum": 0, "maximum": 255 },
            "b": { "type": "integer", "minimum": 0, "maximum": 255 },
            "a": { "type": "integer", "minimum": 0, "maximum": 255 }
          }
        },
        "marshInputs": {
          "type": "boolean",
          "description": "Whether inputs should be marshalled (script components)."
        },
        "marshOutputs": {
          "type": "boolean",
          "description": "Whether outputs should be marshalled (script components)."
        },
        "showStandardOutput": {
          "type": "boolean",
          "description": "Whether to show the standard output/error parameter (script components)."
        },
        "listMode": {
          "type": "string",
          "description": "Display mode for value list components.",
          "enum": ["DropDown", "CheckList", "Sequence", "Cycle", "Toggle"]
        },
        "selectedIndices": {
          "type": "array",
          "description": "Indices of selected items in a value list.",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "font": {
          "type": "object",
          "description": "Font configuration for text components.",
          "properties": {
            "name": { "type": "string" },
            "size": { "type": "number" },
            "bold": { "type": "boolean" },
            "italic": { "type": "boolean" }
          }
        },
        "corners": {
          "type": "array",
          "description": "Corner points for scribble components.",
          "items": {
            "type": "object",
            "properties": {
              "x": { "type": "number" },
              "y": { "type": "number" }
            }
          }
        },
        "drawIndices": {
          "type": "boolean",
          "description": "Whether to draw indices (panels)."
        },
        "drawPaths": {
          "type": "boolean",
          "description": "Whether to draw paths (panels)."
        },
        "alignment": {
          "type": "integer",
          "description": "Text alignment for panels (0=Left, 1=Center, 2=Right).",
          "minimum": 0,
          "maximum": 2
        },
        "bounds": {
          "type": "object",
          "description": "Size bounds for panels and UI components.",
          "properties": {
            "width": { "type": "number", "minimum": 0 },
            "height": { "type": "number", "minimum": 0 }
          }
        },
        "rounding": {
          "type": "string",
          "description": "Rounding mode for number sliders.",
          "enum": ["Round", "None", "Even", "Odd"]
        },
        "additionalProperties": {
          "type": "object",
          "description": "Additional component-specific properties.",
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "vbScriptCode": {
      "type": "object",
      "description": "The three code sections of a VB Script component.",
      "properties": {
        "imports": {
          "type": "string",
          "description": "The imports section (Using statements)."
        },
        "script": {
          "type": "string",
          "description": "The main RunScript code section."
        },
        "additional": {
          "type": "string",
          "description": "Additional code section for helper methods."
        }
      },
      "additionalProperties": false
    },
    "connectionPairing": {
      "type": "object",
      "description": "A connection (wire) between two component parameters.",
      "required": ["from", "to"],
      "properties": {
        "from": {
          "$ref": "#/$defs/connectionEndpoint",
          "description": "The source endpoint (output parameter)."
        },
        "to": {
          "$ref": "#/$defs/connectionEndpoint",
          "description": "The target endpoint (input parameter)."
        }
      },
      "additionalProperties": false
    },
    "connectionEndpoint": {
      "type": "object",
      "description": "An endpoint of a connection, referencing a component parameter.",
      "required": ["id", "paramName"],
      "properties": {
        "id": {
          "type": "integer",
          "description": "The integer ID of the component.",
          "minimum": 1
        },
        "paramName": {
          "type": "string",
          "description": "The name of the parameter on the component."
        },
        "paramIndex": {
          "type": "integer",
          "description": "The zero-based index of the parameter. Used for reliable matching regardless of display name settings.",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "group": {
      "type": "object",
      "description": "A Grasshopper group containing multiple components.",
      "properties": {
        "instanceGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for this group instance."
        },
        "name": {
          "type": "string",
          "description": "The name/nickname of the group."
        },
        "color": {
          "type": "string",
          "description": "The group color in ARGB format (e.g., '255,0,200,0').",
          "pattern": "^\\d{1,3},\\d{1,3},\\d{1,3},\\d{1,3}$"
        },
        "members": {
          "type": "array",
          "description": "List of component integer IDs that belong to this group.",
          "items": {
            "type": "integer",
            "minimum": 1
          }
        }
      },
      "additionalProperties": false
    }
  }
}
