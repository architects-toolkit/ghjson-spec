{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://architects-toolkit.github.io/ghjson-spec/schema/v1.0/ghjson.schema.json",
  "title": "GhJSON Document",
  "description": "GhJSON is a JSON-based format for representing Grasshopper definitions. It provides a human-readable, portable way to serialize and deserialize Grasshopper documents.",
  "type": "object",
  "required": ["components"],
  "properties": {
    "schema": {
      "type": "string",
      "description": "The GhJSON schema version. Used for compatibility checking.",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "default": "1.0",
      "examples": ["1.0", "1.1"]
    },
    "metadata": {
      "$ref": "#/$defs/documentMetadata",
      "description": "Optional document metadata including author, description, and version information."
    },
    "components": {
      "type": "array",
      "description": "List of all components in the document. This is the primary content of a GhJSON file.",
      "items": {
        "$ref": "#/$defs/componentData"
      }
    },
    "connections": {
      "type": "array",
      "description": "List of all connections (wires) between component parameters.",
      "items": {
        "$ref": "#/$defs/connectionData"
      }
    },
    "groups": {
      "type": "array",
      "description": "List of component groups for organization.",
      "items": {
        "$ref": "#/$defs/groupData"
      }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "documentMetadata": {
      "type": "object",
      "description": "Metadata about the Grasshopper document.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the definition."
        },
        "description": {
          "type": "string",
          "description": "A description of what this definition does."
        },
        "version": {
          "type": "string",
          "description": "Version of the definition itself (not the schema). On every save, the version should be incremented.",
          "examples": ["1", "2", "3"],
          "pattern": "^\\d+$",
          "default": "1"
        },
        "author": {
          "type": "string",
          "description": "The author of this definition."
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp in ISO 8601 format."
        },
        "modified": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification timestamp in ISO 8601 format."
        },
        "rhinoVersion": {
          "type": "string",
          "description": "The Rhino version this definition was created with.",
          "examples": ["8.24", "7.12"]
        },
        "grasshopperVersion": {
          "type": "string",
          "description": "The Grasshopper version this definition was created with."
        },
        "tags": {
          "type": "array",
          "description": "List of tags for categorizing and searching definitions.",
          "items": {
            "type": "string"
          }
        },
        "dependencies": {
          "type": "array",
          "description": "List of required plugin dependencies.",
          "items": {
            "type": "string"
          }
        },
        "componentCount": {
          "type": "integer",
          "description": "Total number of components in the document.",
          "minimum": 0
        },
        "connectionCount": {
          "type": "integer",
          "description": "Total number of connections in the document.",
          "minimum": 0
        },
        "groupCount": {
          "type": "integer",
          "description": "Total number of groups in the document.",
          "minimum": 0
        },
        "generatorName": {
          "type": "string",
          "description": "Name of the tool that generated this GhJSON file."
        },
        "generatorVersion": {
          "type": "string",
          "description": "Version of the tool that generated this file."
        },
        "extensions": {
          "allOf": [
            {
              "$ref": "extensions/extensions.schema.json"
            }
          ],
          "description": "Extension point for metadata produced by object handlers. Known extension keys MAY be validated against official extension schemas. Unknown keys are allowed but values MUST be objects."
        }
      },
      "additionalProperties": false
    },
    "argbString": {
      "type": "string",
      "description": "ARGB color in prefixed format (e.g., 'argb:255,0,200,0').",
      "pattern": "^argb:(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"
    },
    "internalizedDataTree": {
      "type": "object",
      "description": "Internalized data tree. The first-level keys are Grasshopper paths (e.g., '{0}'). Each path maps to an object whose keys are item identifiers (e.g., '{0}(0)') and whose values are prefixed strings (e.g., 'text:hello').",
      "propertyNames": {
        "type": "string",
        "pattern": "^\\{.*\\}$"
      },
      "additionalProperties": {
        "type": "object",
        "additionalProperties": {
          "type": "string"
        }
      }
    },
    "componentData": {
      "type": "object",
      "description": "Represents a single Grasshopper component or floating parameter.",
      "anyOf": [
        { "required": ["name", "id"] },
        { "required": ["name", "instanceGuid"] },
        { "required": ["componentGuid", "id"] },
        { "required": ["componentGuid", "instanceGuid"] }
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the component. Must match the component's name in the Grasshopper library.",
          "examples": ["Addition", "Panel", "Number Slider", "C# Script"]
        },
        "library": {
          "type": "string",
          "description": "The component library/category (e.g., 'Maths', 'Params')."
        },
        "nickName": {
          "type": "string",
          "description": "Custom nickname for the component."
        },
        "componentGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for the component type. Used to instantiate the correct component class."
        },
        "instanceGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for this specific component instance."
        },
        "id": {
          "type": "integer",
          "description": "Integer ID for compact reference in connections and groups. Must be unique within the document. Each instanceGuid is assigned a unique ID.",
          "minimum": 1
        },
        "pivot": {
          "description": "The position of a component on the Grasshopper canvas.",
          "anyOf": [
            {
              "type": "string",
              "description": "Compact format: 'X,Y' where X and Y are floating-point numbers.",
              "pattern": "^-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?$",
              "examples": ["100,200", "-50.5,300.25"]
            },
            {
              "type": "object",
              "description": "Object format with explicit x and y properties.",
              "required": ["x", "y"],
              "properties": {
                "x": {
                  "type": "number",
                  "description": "The X coordinate on the canvas."
                },
                "y": {
                  "type": "number",
                  "description": "The Y coordinate on the canvas."
                }
              },
              "additionalProperties": false
            }
          ]
        },
        "inputSettings": {
          "type": "array",
          "description": "Configuration for input parameters.",
          "items": {
            "$ref": "#/$defs/parameterSettings"
          }
        },
        "outputSettings": {
          "type": "array",
          "description": "Configuration for output parameters.",
          "items": {
            "$ref": "#/$defs/parameterSettings"
          }
        },
        "componentState": {
          "$ref": "#/$defs/componentState",
          "description": "UI-specific state for the component."
        },
        "errors": {
          "type": "array",
          "description": "List of error messages associated with the component.",
          "items": {
            "type": "string"
          }
        },
        "warnings": {
          "type": "array",
          "description": "List of warning messages associated with the component.",
          "items": {
            "type": "string"
          }
        },
        "remarks": {
          "type": "array",
          "description": "List of remarks associated with the component.",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "parameterSettings": {
      "type": "object",
      "description": "Configuration for a component's input or output parameter.",
      "required": ["parameterName"],
      "properties": {
        "parameterName": {
          "type": "string",
          "description": "The name of the parameter."
        },
        "nickName": {
          "type": "string",
          "description": "Custom nickname for the parameter."
        },
        "variableName": {
          "type": "string",
          "description": "Custom variable name for the parameter. Used by script components."
        },
        "description": {
          "type": "string",
          "description": "Description of the parameter."
        },
        "dataMapping": {
          "type": "string",
          "description": "Data tree mapping mode.",
          "enum": ["none", "flatten", "graft"]
        },
        "expression": {
          "type": "string",
          "description": "Expression that transforms parameter data. The presence of this property implies the parameter has an expression."
        },
        "access": {
          "type": "string",
          "description": "Data access mode for script parameters.",
          "enum": ["item", "list", "tree"]
        },
        "typeHint": {
          "type": "string",
          "description": "Type hint for script parameters (e.g., 'int', 'double', 'Point3d')."
        },
        "isPrincipal": {
          "type": "boolean",
          "description": "Whether this is the principal (master) input parameter. Affects parameter matching behavior."
        },
        "isRequired": {
          "type": "boolean",
          "description": "Whether this parameter is required (cannot be removed). Applicable to variable parameter components."
        },
        "isReparameterized": {
          "type": "boolean",
          "description": "Whether the parameter domain is reparameterized."
        },
        "isReversed": {
          "type": "boolean",
          "description": "Whether to reverse the parameter data order."
        },
        "isSimplified": {
          "type": "boolean",
          "description": "Whether to simplify the parameter data tree."
        },
        "isInverted": {
          "type": "boolean",
          "description": "Whether to invert boolean values (Param_Boolean only)."
        },
        "isUnitized": {
          "type": "boolean",
          "description": "Whether to unitize vectors (Param_Vector only)."
        },
        "internalizedData": {
          "description": "Internalized data for the parameter.",
          "anyOf": [
            {
              "$ref": "#/$defs/internalizedDataTree"
            },
            {
              "type": "object",
              "properties": {
                "value": {
                  "$ref": "#/$defs/internalizedDataTree"
                }
              },
              "required": ["value"],
              "additionalProperties": false
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "componentState": {
      "type": "object",
      "description": "UI-specific state for components. The properties used depend on the component type.",
      "properties": {
        "selected": {
          "type": "boolean",
          "description": "Whether the component is currently selected on the canvas."
        },
        "locked": {
          "type": "boolean",
          "description": "Whether the component is locked (disabled)."
        },
        "hidden": {
          "type": "boolean",
          "description": "Whether the component preview is hidden."
        },
        "extensions": {
          "allOf": [
            {
              "$ref": "extensions/extensions.schema.json"
            }
          ],
          "description": "Extension point for future object handlers. Known extension keys MAY be validated against official extension schemas. Unknown keys are allowed but values MUST be objects."
        }
      },
      "additionalProperties": true
    },
    "connectionData": {
      "type": "object",
      "description": "A connection (wire) between two component parameters.",
      "required": ["from", "to"],
      "properties": {
        "from": {
          "$ref": "#/$defs/connectionEndpoint",
          "description": "The source endpoint (output parameter)."
        },
        "to": {
          "$ref": "#/$defs/connectionEndpoint",
          "description": "The target endpoint (input parameter)."
        }
      },
      "additionalProperties": false
    },
    "connectionEndpoint": {
      "type": "object",
      "description": "An endpoint of a connection, referencing a component parameter.",
      "anyOf": [
        { "required": ["id", "paramName"] },
        { "required": ["id", "paramIndex"] }
      ],
      "properties": {
        "id": {
          "type": "integer",
          "description": "The integer ID of the component.",
          "minimum": 1
        },
        "paramName": {
          "type": "string",
          "description": "The name of the parameter on the component."
        },
        "paramIndex": {
          "type": "integer",
          "description": "The zero-based index of the parameter. Used for reliable matching regardless of display name settings.",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "groupData": {
      "type": "object",
      "description": "A Grasshopper group containing multiple components.",
      "anyOf": [
        { "required": ["instanceGuid", "members"] },
        { "required": ["id", "members"] }
      ],
      "properties": {
        "instanceGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for this group instance."
        },
        "id": {
          "type": "integer",
          "description": "The integer ID of the group. Must be unique within the file."
        },
        "name": {
          "type": "string",
          "description": "The name of the group."
        },
        "color": {
          "description": "The group color in ARGB format (e.g., 'argb:255,0,200,0').",
          "$ref": "#/$defs/argbString"
        },
        "members": {
          "type": "array",
          "description": "List of component integer IDs that belong to this group.",
          "items": {
            "type": "integer",
            "minimum": 1
          }
        }
      },
      "additionalProperties": false
    }
  }
}
