{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://architects-toolkit.github.io/ghjson-spec/schema/v1.0/ghjson.schema.json",
  "title": "GhJSON Document",
  "description": "GhJSON is a JSON-based format for representing Grasshopper definitions. It provides a human-readable, portable way to serialize and deserialize Grasshopper documents.",
  "type": "object",
  "required": ["components"],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "description": "The GhJSON schema version. Used for compatibility checking.",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "default": "1.0",
      "examples": ["1.0", "1.1"]
    },
    "metadata": {
      "$ref": "#/$defs/documentMetadata",
      "description": "Optional document metadata including author, description, and version information."
    },
    "components": {
      "type": "array",
      "description": "List of all components in the document. This is the primary content of a GhJSON file.",
      "items": {
        "$ref": "#/$defs/componentData"
      }
    },
    "connections": {
      "type": "array",
      "description": "List of all connections (wires) between component parameters.",
      "items": {
        "$ref": "#/$defs/connectionData"
      }
    },
    "groups": {
      "type": "array",
      "description": "List of component groups for organization.",
      "items": {
        "$ref": "#/$defs/groupData"
      }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "documentMetadata": {
      "type": "object",
      "description": "Metadata about the Grasshopper document.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the definition."
        },
        "description": {
          "type": "string",
          "description": "A description of what this definition does."
        },
        "version": {
          "type": "string",
          "description": "Version of the definition itself (not the schema). On every save, the version should be incremented.",
          "examples": ["1", "2", "3"],
          "pattern": "^\\d+$",
          "default": "1"
        },
        "author": {
          "type": "string",
          "description": "The author of this definition."
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp in ISO 8601 format."
        },
        "modified": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification timestamp in ISO 8601 format."
        },
        "rhinoVersion": {
          "type": "string",
          "description": "The Rhino version this definition was created with.",
          "examples": ["8.24", "7.12"]
        },
        "grasshopperVersion": {
          "type": "string",
          "description": "The Grasshopper version this definition was created with."
        },
        "tags": {
          "type": "array",
          "description": "List of tags for categorizing and searching definitions.",
          "items": {
            "type": "string"
          }
        },
        "dependencies": {
          "type": "array",
          "description": "List of required plugin dependencies.",
          "items": {
            "type": "string"
          }
        },
        "componentCount": {
          "type": "integer",
          "description": "Total number of components in the document.",
          "minimum": 0
        },
        "connectionCount": {
          "type": "integer",
          "description": "Total number of connections in the document.",
          "minimum": 0
        },
        "groupCount": {
          "type": "integer",
          "description": "Total number of groups in the document.",
          "minimum": 0
        },
        "generatorName": {
          "type": "string",
          "description": "Name of the tool that generated this GhJSON file."
        },
        "generatorVersion": {
          "type": "string",
          "description": "Version of the tool that generated this file."
        }
      },
      "additionalProperties": true
    },
    "componentData": {
      "type": "object",
      "description": "Represents a single Grasshopper component or floating parameter.",
      "anyOf": [
        { "required": ["name", "id"] },
        { "required": ["name", "instanceGuid"] },
        { "required": ["componentGuid", "id"] },
        { "required": ["componentGuid", "instanceGuid"] }
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the component. Must match the component's name in the Grasshopper library.",
          "examples": ["Addition", "Panel", "Number Slider", "C# Script"]
        },
        "library": {
          "type": "string",
          "description": "The component library/category (e.g., 'Maths', 'Params')."
        },
        "nickName": {
          "type": "string",
          "description": "Custom nickname for the component."
        },
        "componentGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for the component type. Used to instantiate the correct component class."
        },
        "instanceGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for this specific component instance."
        },
        "id": {
          "type": "integer",
          "description": "Integer ID for compact reference in connections and groups. Must be unique within the document. Each instanceGuid is assigned a unique ID.",
          "minimum": 1
        },
        "pivot": {
          "description": "The position of a component on the Grasshopper canvas in the compact format: 'X,Y' where X and Y are floating-point numbers.",
          "type": "string",
          "pattern": "^-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?$",
          "examples": ["100,200", "-50.5,300.25"]
        },
        "properties": {
          "type": "object",
          "description": "Simple key-value pairs for basic component properties.",
          "additionalProperties": true
        },
        "inputSettings": {
          "type": "array",
          "description": "Configuration for input parameters.",
          "items": {
            "$ref": "#/$defs/parameterSettings"
          }
        },
        "outputSettings": {
          "type": "array",
          "description": "Configuration for output parameters.",
          "items": {
            "$ref": "#/$defs/parameterSettings"
          }
        },
        "componentState": {
          "$ref": "#/$defs/componentState",
          "description": "UI-specific state for the component."
        },
        "warnings": {
          "type": "array",
          "description": "List of warning messages associated with the component.",
          "items": {
            "type": "string"
          }
        },
        "errors": {
          "type": "array",
          "description": "List of error messages associated with the component.",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "parameterSettings": {
      "type": "object",
      "description": "Configuration for a component's input or output parameter.",
      "required": ["parameterName"],
      "properties": {
        "parameterName": {
          "type": "string",
          "description": "The name of the parameter."
        },
        "nickName": {
          "type": "string",
          "description": "Custom nickname for the parameter."
        },
        "description": {
          "type": "string",
          "description": "Description of the parameter."
        },
        "isPrincipal": {
          "type": "boolean",
          "description": "Whether this is the principal (master) input parameter. Affects parameter matching behavior."
        },
        "required": {
          "type": "boolean",
          "description": "Whether this parameter is required (cannot be removed). Applicable to variable parameter components."
        },
        "dataMapping": {
          "type": "string",
          "description": "Data tree mapping mode.",
          "enum": ["None", "Flatten", "Graft", "Simplify"]
        },
        "isReparameterized": {
          "type": "boolean",
          "description": "Whether the parameter domain is reparameterized."
        },
        "expression": {
          "type": "string",
          "description": "Expression that transforms parameter data. The presence of this property implies the parameter has an expression."
        },
        "variableName": {
          "type": "string",
          "description": "Variable name for script parameters."
        },
        "access": {
          "type": "string",
          "description": "Data access mode for script parameters.",
          "enum": ["item", "list", "tree"]
        },
        "typeHint": {
          "type": "string",
          "description": "Type hint for script parameters (e.g., 'int', 'double', 'Point3d')."
        },
        "reverse": {
          "type": "boolean",
          "description": "Whether to reverse the parameter data order."
        },
        "simplify": {
          "type": "boolean",
          "description": "Whether to simplify the parameter data tree."
        },
        "locked": {
          "type": "boolean",
          "description": "Whether the parameter is locked."
        },
        "invert": {
          "type": "boolean",
          "description": "Whether to invert boolean values (Param_Boolean only)."
        },
        "unitize": {
          "type": "boolean",
          "description": "Whether to unitize vectors (Param_Vector only)."
        }
      },
      "additionalProperties": false
    },
    "componentState": {
      "type": "object",
      "description": "UI-specific state for components. The properties used depend on the component type.",
      "properties": {
        "value": {
          "description": "The primary value for the component. Format depends on component type:\n- Number Slider: '5<2,10>' (value with range)\n- Panel/Scribble: 'text content'\n- Value List: [{\"Name\":\"A\",\"Expression\":\"0\"}]\n- Script (C#/Python): 'code string'\n- Multidimensional Slider: '1.0,2.0,3.0'"
        },
        "selected": {
          "type": "boolean",
          "description": "Whether the component is currently selected on the canvas."
        },
        "locked": {
          "type": "boolean",
          "description": "Whether the component is locked (disabled)."
        },
        "hidden": {
          "type": "boolean",
          "description": "Whether the component preview is hidden."
        },
        "multiline": {
          "type": "boolean",
          "description": "Panel: Whether multiline mode is enabled (panels, text components)."
        },
        "wrap": {
          "type": "boolean",
          "description": "Panel: Whether text wrapping is enabled."
        },
        "color": {
          "type": "string",
          "description": "Panel: Component color in ARGB format (e.g., '255,128,64,255').",
          "pattern": "^(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"
        },
        "marshInputs": {
          "type": "boolean",
          "description": "Script: Whether inputs should be marshalled (script components)."
        },
        "marshOutputs": {
          "type": "boolean",
          "description": "Script: Whether outputs should be marshalled (script components)."
        },
        "showStandardOutput": {
          "type": "boolean",
          "description": "Script: Whether to show the standard output/error parameter (script components)."
        },
        "vbCode": {
          "$ref": "#/$defs/vbScriptCode",
          "description": "Script: VB Script code with separate sections. Takes precedence over 'value' for VB Script components."
        },
        "listMode": {
          "type": "string",
          "description": "ValueList: Display mode for value list components.",
          "enum": ["DropDown", "CheckList", "Sequence", "Cycle", "Toggle"]
        },
        "selectedIndices": {
          "type": "array",
          "description": "ValueList: Indices of selected items in a value list.",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        },
        "font": {
          "type": "object",
          "description": "Panel: Font configuration for text components.",
          "properties": {
            "name": { "type": "string" },
            "size": { "type": "number" },
            "bold": { "type": "boolean" },
            "italic": { "type": "boolean" }
          }
        },
        "corners": {
          "type": "array",
          "description": "Scribble: Corner points for scribble components.",
          "items": {
            "type": "string",
            "description": "Corner point in format 'x,y' (e.g., '10,20')",
            "pattern": "^-?\\d+(\\.\\d+)?,-?\\d+(\\.\\d+)?$"
          }
        },
        "drawIndices": {
          "type": "boolean",
          "description": "Panel: Whether to draw indices."
        },
        "drawPaths": {
          "type": "boolean",
          "description": "Panel: Whether to draw paths."
        },
        "alignment": {
          "type": "integer",
          "description": "Panel: Text alignment (0=Left, 1=Center, 2=Right).",
          "minimum": 0,
          "maximum": 2
        },
        "bounds": {
          "description": "Panel: Size bounds for resizable components. Format: 'WxH' (e.g., '100x200')",
          "type": "string",
          "pattern": "^\\d+(\\.\\d+)?x\\d+(\\.\\d+)?$"
        },
        "rounding": {
          "type": "string",
          "description": "Number Slider: Rounding mode for number sliders.",
          "enum": ["Float", "Integer", "Even", "Odd"]
        },
        "additionalProperties": {
          "type": "object",
          "description": "Additional component-specific properties.",
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "vbScriptCode": {
      "type": "object",
      "description": "The three code sections of a VB Script component.",
      "properties": {
        "imports": {
          "type": "string",
          "description": "The imports section (Using statements)."
        },
        "script": {
          "type": "string",
          "description": "The main RunScript code section."
        },
        "additional": {
          "type": "string",
          "description": "Additional code section for helper methods."
        }
      },
      "additionalProperties": false
    },
    "connectionData": {
      "type": "object",
      "description": "A connection (wire) between two component parameters.",
      "required": ["from", "to"],
      "properties": {
        "from": {
          "$ref": "#/$defs/connectionEndpoint",
          "description": "The source endpoint (output parameter)."
        },
        "to": {
          "$ref": "#/$defs/connectionEndpoint",
          "description": "The target endpoint (input parameter)."
        }
      },
      "additionalProperties": false
    },
    "connectionEndpoint": {
      "type": "object",
      "description": "An endpoint of a connection, referencing a component parameter.",
      "anyOf": [
        { "required": ["id", "paramName"] },
        { "required": ["id", "paramIndex"] }
      ],
      "properties": {
        "id": {
          "type": "integer",
          "description": "The integer ID of the component.",
          "minimum": 1
        },
        "paramName": {
          "type": "string",
          "description": "The name of the parameter on the component."
        },
        "paramIndex": {
          "type": "integer",
          "description": "The zero-based index of the parameter. Used for reliable matching regardless of display name settings.",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "groupData": {
      "type": "object",
      "description": "A Grasshopper group containing multiple components.",
      "anyOf": [
        { "required": ["instanceGuid", "members"] },
        { "required": ["id", "members"] }
      ],
      "properties": {
        "instanceGuid": {
          "type": "string",
          "format": "uuid",
          "description": "The unique identifier for this group instance."
        },
        "id": {
          "type": "integer",
          "description": "The integer ID of the group. Must be unique within the file."
        },
        "name": {
          "type": "string",
          "description": "The name of the group."
        },
        "color": {
          "type": "string",
          "description": "The group color in ARGB format (e.g., '255,0,200,0').",
          "pattern": "^(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]),(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"
        },
        "members": {
          "type": "array",
          "description": "List of component integer IDs that belong to this group.",
          "items": {
            "type": "integer",
            "minimum": 1
          }
        }
      },
      "additionalProperties": false
    }
  }
}
